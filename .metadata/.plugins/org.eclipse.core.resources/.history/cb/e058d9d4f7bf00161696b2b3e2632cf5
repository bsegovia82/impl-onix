<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/WEB-INF/template_mantenedor.xhtml">

	<ui:define name="head">
		<title>#{beanMantenedorExamen.tituloPagina}</title>

		<style>
.dialogoAdicionalFormulario {
	vertical-align: top;
	width: 45%;
}

.dialogoAdicionalTabla {
	vertical-align: top;
	width: 55%;
}

.dialogoAdicionalTreeTable {
	vertical-align: top;
	width: 40%;
}

.dialogoAdicionalTablaUsuario {
	vertical-align: top;
	width: 60%;
}

.ui-tree {
	width: 90%;
	position: relative;
}
</style>

	</ui:define>
	<ui:define name="subheader">
       #{beanMantenedorExamen.descripcionPagina}
    </ui:define>

	<ui:define name="titulo_tab">
		#{beanMantenedorExamen.tab}
	</ui:define>
	<ui:define name="cab_formulario">		
		#{beanMantenedorExamen.ayudaPagina}
	</ui:define>
	<ui:define name="grid_formulario">
		<p:panelGrid columns="2" layout="grid"
			style="border:0px !important; background:none;" id="panel">

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nombre:" />
				</div>
				<p:inputText styleClass="Wid70" placeholder="Nombre Examen"
					value="#{beanMantenedorExamen.examenActual.nombreExamen}"
					onblur="ChangeCase(this);" required="true" id="Examen" />
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Descripción:" />
				</div>
				<p:inputTextarea styleClass="Wid70" placeholder="Descripción"
					value="#{beanMantenedorExamen.examenActual.descripcionExamen}"
					onblur="ChangeCase(this);" required="true" id="Descripción"></p:inputTextarea>
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Número Preguntas:" />
				</div>
				<p:spinner min="1" max="100" placeholder="Número Preguntas"
					value="#{beanMantenedorExamen.examenActual.numeroPreguntas}"
					styleClass="Wid70" required="true" id="NumeroPreguntas" />
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Tiempo Minutos:" />
				</div>

				<p:spinner min="1" max="100" placeholder="Tiempo Máximo"
					value="#{beanMantenedorExamen.examenActual.tiempo}" required="true"
					id="Tiempo" styleClass="Wid70" />

			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nota Máxima:" />
				</div>

				<p:spinner min="1" max="100" placeholder="Nota Máxima"
					value="#{beanMantenedorExamen.examenActual.notaMaxima}"
					required="true" id="Nota" styleClass="Wid70" />
			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nota Aprobación:" />
				</div>

				<p:spinner min="1" max="100" placeholder="Nota Aprobación"
					value="#{beanMantenedorExamen.examenActual.notaAprobacion}"
					required="true" id="NotaAprobacion" styleClass="Wid70" />
			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Fecha Inicio:" />
				</div>
				<p:calendar pattern="dd/MM/yyyy" id="FechaDisponibilidad"
					placeholder="Fecha Disponibilidad" required="true"
					value="#{beanMantenedorExamen.examenActual.fechaDisponibilidad}"></p:calendar>
			</pe:fluidGridItem>

			<h:outputText value="" />

		</p:panelGrid>

		<div class="EmptyBox60"></div>
		<p:commandButton value="Cancelar" styleClass="RedButton"
			update="panel" process="@this">
			<p:resetInput target="panel" />
		</p:commandButton>

		<p:commandButton value="Registrar" styleClass="CyanButton"
			actionListener="#{beanMantenedorExamen.guardarOActualizar}"
			process="contenedor"
			update=":#{p:component('contenedor')}, :#{p:component('mensajeGlobal')}, :#{p:component('tablaDatos')}, :#{p:component('dialogoMantenimiento')}" />
	</ui:define>
	<ui:define name="cab_tabla_datos">
		#{beanMantenedorExamen.cabeceraTabla}
	</ui:define>

	<ui:define name="tabla_datos">
		<p:dataTable value="#{beanMantenedorExamen.listaEntidades}"
			var="examen" emptyMessage="#{beanMantenedorExamen.mensajeTablaVacia}"
			rows="8" reflow="true" paginator="true" paginatorPosition="bottom"
			id="tablaDatos" paginatorAlwaysVisible="false">

			<p:column filterBy="#{examen.nombreExamen}"
				footerText="Nombre Examen">
				<h:outputText value="#{examen.nombreExamen}" />
			</p:column>

			<p:column headerText="Descripción">
				<h:outputText value="#{examen.descripcionExamen}" />
			</p:column>

			<p:column headerText="No. Preguntas" width="9%">
				<center>
					<h:outputText value="#{examen.numeroPreguntas}" />
				</center>
			</p:column>

			<p:column headerText="Minutos" width="8%">
				<center>
					<h:outputText value="#{examen.tiempo}" />
				</center>
			</p:column>

			<p:column headerText="Nota Máxima" width="8%">
				<center>
					<h:outputText value="#{examen.notaMaxima}" />
				</center>
			</p:column>

			<p:column headerText="Nota Aprobado" width="9%">
				<center>
					<h:outputText value="#{examen.notaAprobacion}" />
				</center>
			</p:column>

			<p:column headerText="Proceso" width="8%">

				<h:outputText value="#{examen.descripcionProceso}" />


			</p:column>



			<p:column headerText="Estado" width="7%">
				<h:outputText
					value="#{examen.estado eq beanMantenedorExamen.estadoActivo?'ACTIVO':'INACTIVO'}" />
			</p:column>

			<p:column headerText="Fecha Disponible" width="10%">
				<h:outputText value="#{examen.fechaDisponibilidad}">
					<f:convertDateTime pattern="dd/MM/yyyy"
						timeZone="#{beanMantenedorExamen.currentTimeZone}" />
				</h:outputText>
			</p:column>



			<p:column headerText="Acciones" width="10%">

				<p:panelGrid columns="2" layout="grid"
					style="border : none; background : none;">

					<p:commandLink title="Publicar Examen"
						 process="@this"
						 actionListener="#{beanMantenedorExamen.publicar}"
						 update=":#{p:component('tablaDatos')}, :#{p:component('mensajeGlobal')}"
						 >
						<i class="icon-publish Fs20 BoldGray DispBlock"> </i>
						<f:attribute name="EXAMEN_SELECCIONADO_PUBLICAR" value="#{examen}"></f:attribute>
					</p:commandLink>

					<p:commandLink title="Cerrar Examen"
						 process="@this"
						 actionListener="#{beanMantenedorExamen.cerrar}"
						 update=":#{p:component('tablaDatos')}, :#{p:component('mensajeGlobal')}"
						 >
						<i class="icon-lock Fs20 BoldGray DispBlock"> </i>
						<f:attribute name="EXAMEN_SELECCIONADO_CERRAR" value="#{examen}"></f:attribute>
					</p:commandLink>
					
					

					<p:commandLink title="Asignar Banco Preguntas"
						actionListener="#{beanMantenedorExamenBanco.verPreguntas}"
						update=":#{p:component('dialogoBancoExamen')}" process="@this"
						rendered="#{beanMantenedorExamen.presentarBotonAccion(examen)}"
						>

						<i class="fa fa-sitemap Fs20 BoldGray DispBlock"> </i>

						<f:attribute name="EXAMEN_SELECCIONADO_BANCO" value="#{examen}"></f:attribute>

					</p:commandLink>

					<p:commandLink title="Asignar Usuarios"
						actionListener="#{beanMantenedorExamenUsuario.verUsuarios}"
						update=":#{p:component('dialogoAsignacionUsuario')}"
						process="@this" rendered="#{beanMantenedorExamen.presentarBotonAccion(examen)}">

						<i class="fa fa-user-secret Fs20 BoldGray DispBlock"> </i>

						<f:attribute name="EXAMEN_SELECCIONADO_USUARIO" value="#{examen}"></f:attribute>

					</p:commandLink>

					<p:commandLink title="Actualizar"
						actionListener="#{beanMantenedorExamen.actualizarEntidad}"
						update=":#{p:component('dialogoMantenimiento')}" process="@this" rendered="#{beanMantenedorExamen.presentarBotonAccion(examen)}">

						<i class="fa fa-edit Fs20 BoldGray DispBlock"> </i>

						<f:attribute
							name="#{beanMantenedorExamen.nombreAtributoCambioEstado}"
							value="#{examen}"></f:attribute>

					</p:commandLink>
					<p:commandLink title="Cambiar Estado"
						actionListener="#{beanMantenedorExamen.cambiarEstado}"
						update="@form" process="@this" rendered="#{beanMantenedorExamen.presentarBotonAccion(examen)}">

						<i class="icon-settings_backup_restore Fs20 BoldGray DispBlock">
						</i>
						<f:attribute
							name="#{beanMantenedorExamen.nombreAtributoCambioEstado}"
							value="#{examen}"></f:attribute>

						<p:confirm header="Confirmación"
							message="Seguro que desea realizar esta operación?"
							icon="ui-icon-alert" />
					</p:commandLink>


				</p:panelGrid>
			</p:column>
		</p:dataTable>
	</ui:define>


	<ui:define name="cab_dialogo">
		#{beanMantenedorExamen.cabeceraDialogo}
	</ui:define>
	<ui:define name="cab_panel_dialogo">
#{beanMantenedorExamen.cabeceraPanelDialogo}
</ui:define>

	<ui:define name="datos_dialogo">
		<p:panelGrid columns="2" layout="grid"
			style="border:0px !important; background:none;" id="panel">

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nombre:" />
				</div>
				<p:inputText styleClass="Wid70" placeholder="Nombre Examen"
					value="#{beanMantenedorExamen.examenActual.nombreExamen}"
					onblur="ChangeCase(this);" required="true" id="Examen" />
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Descripción:" />
				</div>
				<p:inputTextarea styleClass="Wid70" placeholder="Descripción"
					value="#{beanMantenedorExamen.examenActual.descripcionExamen}"
					onblur="ChangeCase(this);" required="true" id="Descripción"></p:inputTextarea>
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Número Preguntas:" />
				</div>
				<p:inputText styleClass="Wid70" placeholder="Número Preguntas"
					value="#{beanMantenedorExamen.examenActual.numeroPreguntas}"
					onblur="ChangeCase(this);" required="true" id="NumeroPreguntas" />
			</pe:fluidGridItem>
			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Tiempo Minutos:" />
				</div>
				<p:inputText styleClass="Wid70" placeholder="Tiempo"
					value="#{beanMantenedorExamen.examenActual.tiempo}"
					onblur="ChangeCase(this);" required="true" id="Tiempo" />
			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nota Máxima:" />
				</div>
				<p:inputText styleClass="Wid70" placeholder="Nota Máxima"
					value="#{beanMantenedorExamen.examenActual.notaMaxima}"
					onblur="ChangeCase(this);" required="true" id="Nota" />
			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Nota Aprobación:" />
				</div>

				<p:spinner min="1" max="100" placeholder="Nota Aprobación"
					value="#{beanMantenedorExamen.examenActual.notaAprobacion}"
					required="true" id="NotaAprobacion" styleClass="Wid70" />
			</pe:fluidGridItem>

			<pe:fluidGridItem type="input">
				<div class="dynaFormLabel">
					<p:outputLabel value="* Fecha Inicio:" />
				</div>
				<p:calendar pattern="dd/MM/yyyy" id="FechaDisponibilidad"
					placeholder="Fecha Disponibilidad" required="true"
					value="#{beanMantenedorExamen.examenActual.fechaDisponibilidad}"></p:calendar>
			</pe:fluidGridItem>

			<h:outputText value="" />

		</p:panelGrid>
		<p:commandButton value="Actualizar" styleClass="CyanButton"
			actionListener="#{beanMantenedorExamen.guardarOActualizar}"
			process="PanelActualizar"
			update=":#{p:component('mensajeGlobal')}, :#{p:component('tablaDatos')}">
			<p:confirm header="Confirmación"
				message="Seguro que desea realizar esta operación?"
				icon="ui-icon-alert" />
		</p:commandButton>
	</ui:define>

	<ui:define name="ventanas_adicionales">

		<p:dialog widgetVar="dialogoBancoExamen" modal="true" height="80%"
			id="dialogoBancoExamen" width="60%">


			<f:facet name="header">
			Asignación banco preguntas Examen :  <h:outputText
					value="#{beanMantenedorExamenBanco.lExamen.nombreExamen}" />

				<h:outputText value=" -- " />
					
					Preguntas a asignar : <h:outputText
					value="#{beanMantenedorExamenBanco.lExamen.numeroPreguntas}" />
			</f:facet>
			<h:panelGrid columns="2"
				columnClasses="dialogoAdicionalFormulario, dialogoAdicionalTabla">

				<p:panel id="PanelBancoExamen">
					<f:facet name="header">
				Asignacion de Bancos
			</f:facet>

					<p:panelGrid columns="2" layout="grid"
						style="border:0px !important; background:none;"
						id="panelAsignacionBanco">

						<p:tree value="#{beanMantenedorExamenBanco.nodoRaiz}"
							var="bancoPregunas" selectionMode="single">
							<p:treeNode expandedIcon="ui-icon-folder-open"
								collapsedIcon="ui-icon-folder-collapsed">
								<h:outputText value="#{bancoPregunas}" />

							</p:treeNode>

							<p:ajax event="select"
								update=":#{p:component('NombreBanco')}, :#{p:component('mensajeGlobal')}"
								listener="#{beanMantenedorExamenBanco.onNodeSelect}"
								process="@this" />

							<p:treeNode icon="ui-icon-document" type="hoja">
								<h:outputText value="#{bancoPregunas}" />

							</p:treeNode>
						</p:tree>

						<p:panelGrid columns="1" layout="grid"
							style="border:0px !important;" id="panelDatosAsignacionBanco">

							<pe:fluidGridItem type="input">
								<div class="dynaFormLabel">
									<p:outputLabel value="* Nombre Banco:" />
								</div>
								<p:inputText styleClass="Wid70" placeholder="Nombre Banco"
									value="#{beanMantenedorExamenBanco.lBancoSeleccionado.lNombreBanco}"
									onblur="ChangeCase(this);" required="true" id="NombreBanco"
									readonly="true" />
							</pe:fluidGridItem>

							<pe:fluidGridItem type="input">
								<div class="dynaFormLabel">
									<p:outputLabel value="* Cant. Pregunta:" />
								</div>
								<p:spinner id="Orden" required="true" min="1" max="100"
									placeholder="Ingrese el Cant. Pregunta"
									value="#{beanMantenedorExamenBanco.examenBancoActual.lPreguntasBanco}" />
							</pe:fluidGridItem>

						</p:panelGrid>
					</p:panelGrid>

					<div class="EmptyBox60"></div>

					<p:commandButton value="Cancelar" styleClass="RedButton"
						update=":#{p:component('panelDatosAsignacionBanco')}"
						process="@this">
						<p:resetInput target="panelDatosAsignacionBanco" />
					</p:commandButton>

					<p:commandButton value="Registrar" styleClass="CyanButton"
						actionListener="#{beanMantenedorExamenBanco.guardarOActualizar}"
						process="PanelBancoExamen"
						update=":#{p:component('PanelBancoExamen')}, :#{p:component('mensajeGlobal')}, :#{p:component('tablaDatosExamenBanco')}" />

				</p:panel>



				<p:panel header="Bancos Asignados">


					<p:dataTable var="bancoAsignado"
						emptyMessage="#{beanMantenedorExamenBanco.mensajeTablaVacia}"
						rows="4" reflow="true" paginator="true" paginatorPosition="bottom"
						id="tablaDatosExamenBanco" paginatorAlwaysVisible="false"
						value="#{beanMantenedorExamenBanco.listaEntidades}">

						<p:column headerText="Banco">
							<h:outputText value="#{bancoAsignado.lBanco.lNombreBanco}" />
						</p:column>

						<p:column headerText="Cantidad Preguntas" width="15%">
							<center>
								<h:outputText value="#{bancoAsignado.lPreguntasBanco}" />
							</center>
						</p:column>

						<p:column headerText="Estado" width="15%">
							<h:outputText
								value="#{bancoAsignado.estado eq beanMantenedorExamenBanco.estadoActivo?'ACTIVO':'INACTIVO'}" />
						</p:column>

						<p:column headerText="Fecha Registro" width="20%">
							<h:outputText value="#{bancoAsignado.fechaRegistro}">
								<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"
									timeZone="#{beanMantenedorExamenBanco.currentTimeZone}" />
							</h:outputText>
						</p:column>


						<p:column headerText="Acciones" width="20%">

							<p:panelGrid columns="2" layout="grid"
								style="border : none; background : none;">

								<p:commandLink title="Actualizar"
									actionListener="#{beanMantenedorExamenBanco.actualizarEntidadFormulario}"
									update=":#{p:component('PanelBancoExamen')}" process="@this">

									<i class="fa fa-edit Fs20 BoldGray DispBlock"> </i>

									<f:attribute
										name="#{beanMantenedorExamenBanco.nombreAtributoCambioEstado}"
										value="#{bancoAsignado}"></f:attribute>

								</p:commandLink>
								<p:commandLink title="Cambiar Estado"
									actionListener="#{beanMantenedorExamenBanco.cambiarEstado}"
									update="@form" process="@this">

									<i class="icon-settings_backup_restore Fs20 BoldGray DispBlock">
									</i>
									<f:attribute
										name="#{beanMantenedorExamenBanco.nombreAtributoCambioEstado}"
										value="#{bancoAsignado}"></f:attribute>

									<p:confirm header="Confirmación"
										message="Seguro que desea realizar esta operación?"
										icon="ui-icon-alert" />
								</p:commandLink>


							</p:panelGrid>
						</p:column>


						<f:facet name="footer">
							<p:panelGrid columns="2">
								<h:outputText value="Total Preguntas: ">
								</h:outputText>
								<h:outputText value="#{beanMantenedorExamenBanco.totalPregunta}">
								</h:outputText>
							</p:panelGrid>
						</f:facet>

					</p:dataTable>
				</p:panel>


			</h:panelGrid>



		</p:dialog>

		<p:dialog widgetVar="dialogoAsignacionUsuario" modal="true"
			height="80%" id="dialogoAsignacionUsuario" width="60%">

			<f:facet name="header">
			Asignación usuarios Examen :  <h:outputText
					value="#{beanMantenedorExamenUsuario.lExamen.nombreExamen}" />

			</f:facet>
			<h:panelGrid columns="2"
				columnClasses="dialogoAdicionalTreeTable, dialogoAdicionalTablaUsuario" >

				<p:panel id="PanelAsignacionExamen">
					<f:facet name="header">
							Seleccion de Usuario
						</f:facet>


					<p:treeTable id="arbolUsuario"
						value="#{beanMantenedorExamenUsuario.lRolesUsuarioNodo}"
						var="rolesUsuario" 
						selectionMode="checkbox"
						selection="#{beanMantenedorExamenUsuario.lNodosSeleccionado}"
						scrollable="true" scrollHeight="300" scrollWidth="100%" >

						<p:column headerText="Usuarios Agrupados Por Rol" filterBy="#{rolesUsuario}">
							<h:outputText value="#{rolesUsuario}" />
						</p:column>

					</p:treeTable>  

					<f:facet name="footer">
					<p:commandButton value="Cancelar" styleClass="RedButton"
						update="@([id$=arbolUsuario]), @this" process="@this"
						actionListener="#{beanMantenedorExamenUsuario.limpiarSeleccion}"
						>
					</p:commandButton>

					<p:commandButton value="Registrar" styleClass="CyanButton"
						actionListener="#{beanMantenedorExamenUsuario.guardarMasivo}"
						process="@([id$=PanelAsignacionExamen])"
						update="@([id$=PanelAsignacionExamen]), @([id$=mensajeGlobal]), @([id$=tablaUsuarioAsignadoExamen])" />
					</f:facet>  
				</p:panel>


				<p:panel header="Usuarios Asignados">


					<p:dataTable var="usuarioAsignado"
						emptyMessage="#{beanMantenedorExamenUsuario.mensajeTablaVacia}"
						rows="6" reflow="true" paginator="true" paginatorPosition="bottom"
						id="tablaUsuarioAsignadoExamen" paginatorAlwaysVisible="false"
						value="#{beanMantenedorExamenUsuario.listaEntidades}">

						<p:column footerText="Usuario" filterBy="#{usuarioAsignado.lUsuario.usuario}">
							<h:outputText value="#{usuarioAsignado.lUsuario.usuario}" />
						</p:column>

						<p:column headerText="Descripción">
							<h:outputText value="#{usuarioAsignado.lUsuario.observacion}" />
						</p:column>

						<p:column headerText="Correo">
							<h:outputText value="#{usuarioAsignado.lUsuario.correo}" />
						</p:column>
						
						<p:column headerText="Acciones" width="10%">
							<p:commandLink title="Cambiar Estado"
									actionListener="#{beanMantenedorExamenUsuario.cambiarEstado}"
									update=":#{p:component('tablaUsuarioAsignadoExamen')}" process="@this">

									<i class="icon-settings_backup_restore Fs20 BoldGray DispBlock">
									</i>
									<f:attribute
										name="#{beanMantenedorExamenUsuario.nombreAtributoCambioEstado}"
										value="#{usuarioAsignado}"></f:attribute>

									<p:confirm header="Confirmación"
										message="Seguro que desea realizar esta operación?"
										icon="ui-icon-alert" />
								</p:commandLink>
						</p:column>

					</p:dataTable>
				</p:panel>


			</h:panelGrid>




		</p:dialog>

	</ui:define>

</ui:composition>
